apiVersion: v1
kind: Namespace
metadata:
  name: monitoring
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: prometheus
  namespace: monitoring
  labels:
    app: prometheus
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: prometheus
  labels:
    app: prometheus
rules:
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs:
  - get
  - list
  - watch
- apiGroups: [""] # "" indicates the core API group
  resources:
  - nodes
  - nodes/metrics
  - nodes/proxy
  - services
  - endpoints
  - pods
  verbs:
  - get
  - list
  - watch
- nonResourceURLs:
  - /metrics
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: prometheus
  labels:
    app: prometheus
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: prometheus
subjects:
- kind: ServiceAccount
  name: prometheus
  namespace: monitoring
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-configmap
  namespace: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
    rule_files:
      - "/etc/prometheus-rules/alert.rules"
    alerting:
      alertmanagers:
      - static_configs:
        - targets:
          - alertmanager:9093
    scrape_configs:
    - job_name: 'kubernetes-apiservers'
      kubernetes_sd_configs:
      - role: endpoints
      scheme: https
      tls_config:
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      relabel_configs:
      - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
        action: keep
        regex: default;kubernetes;https
    - job_name: 'kubernetes-nodes'
      scheme: https
      tls_config:
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)
      - target_label: __address__
        replacement: kubernetes.default.svc:443
      - source_labels: [__meta_kubernetes_node_name]
        regex: (.+)
        target_label: __metrics_path__
        replacement: /api/v1/nodes/${1}/proxy/metrics
    - job_name: 'kubernetes-cadvisor'
      scheme: https
      tls_config:
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)
      - target_label: __address__
        replacement: kubernetes.default.svc:443
      - source_labels: [__meta_kubernetes_node_name]
        regex: (.+)
        target_label: __metrics_path__
        replacement: /api/v1/nodes/${1}/proxy/metrics/cadvisor
    - job_name: 'kubernetes-service-endpoints'
      kubernetes_sd_configs:
      - role: endpoints
      relabel_configs:
      - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]
        action: replace
        target_label: __scheme__
        regex: (https?)
      - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]
        action: replace
        target_label: __address__
        regex: ([^:]+)(?::\d+)?;(\d+)
        replacement: $1:$2
      - action: labelmap
        regex: __meta_kubernetes_service_label_(.+)
      - source_labels: [__meta_kubernetes_namespace]
        action: replace
        target_label: kubernetes_namespace
      - source_labels: [__meta_kubernetes_service_name]
        action: replace
        target_label: kubernetes_name
    - job_name: 'kubernetes-services'
      metrics_path: /probe
      params:
        module: [http_2xx]
      kubernetes_sd_configs:
      - role: service
      relabel_configs:
      - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_probe]
        action: keep
        regex: true
      - source_labels: [__address__]
        target_label: __param_target
      - target_label: __address__
        replacement: blackbox-exporter.example.com:9115
      - source_labels: [__param_target]
        target_label: instance
      - action: labelmap
        regex: __meta_kubernetes_service_label_(.+)
      - source_labels: [__meta_kubernetes_namespace]
        target_label: kubernetes_namespace
      - source_labels: [__meta_kubernetes_service_name]
        target_label: kubernetes_name
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
      - role: pod
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
        action: replace
        regex: ([^:]+)(?::\d+)?;(\d+)
        replacement: $1:$2
        target_label: __address__
      - action: labelmap
        regex: __meta_kubernetes_pod_label_(.+)
      - source_labels: [__meta_kubernetes_namespace]
        action: replace
        target_label: kubernetes_namespace
      - source_labels: [__meta_kubernetes_pod_name]
        action: replace
        target_label: kubernetes_pod_name
    - job_name: 'kubernetes-ingresses'
      kubernetes_sd_configs:
      - role: ingress
      relabel_configs:
      - source_labels: [__meta_kubernetes_ingress_annotation_prometheus_io_probe]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_ingress_scheme,__address__,__meta_kubernetes_ingress_path]
        regex: (.+);(.+);(.+)
        replacement: ${1}://${2}${3}
        target_label: __param_target
      - target_label: __address__
        replacement: blackbox-exporter.example.com:9115
      - source_labels: [__param_target]
        target_label: instance
      - action: labelmap
        regex: __meta_kubernetes_ingress_label_(.+)
      - source_labels: [__meta_kubernetes_namespace]
        target_label: kubernetes_namespace
      - source_labels: [__meta_kubernetes_ingress_name]
        target_label: kubernetes_name
    - job_name: 'kube-state-metrics'
      static_configs:
        - targets: ['kube-state-metrics.monitoring.svc.cluster.local:8080']
    - job_name: 'node-exporter'
      kubernetes_sd_configs:
      - role: endpoints
      relabel_configs:
      - source_labels: [__meta_kubernetes_endpoints_name]
        regex: 'node-exporter'
        action: keep# Useful examples on how to configure Prometheus
# * https://www.weave.works/prometheus-and-kubernetes-monitoring-your-applications/
# * https://grafana.net/dashboards/162
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-alertrules
  namespace: monitoring
data:
  alert.rules: |-
    groups:
    - name: HighErrorRate
      rules:
      - alert: HighErrorRate
        expr: rate(request_duration_seconds_count{status_code="500"}[5m]) > 1
        for: 5m
        labels:
          severity: slack
        annotations:
          summary: "High HTTP 500 error rates"
          description: "Rate of HTTP 500 errors per 5 minutes: {{ $value }}"apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus-deployment
  namespace: monitoring
spec:
  replicas: 1
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
    type: RollingUpdate
  selector:
    matchLabels:
      app: prometheus
  template:
    metadata:
      name: prometheus
      labels:
        app: prometheus
    spec:
      serviceAccount: prometheus
      containers:
      - name: prometheus
        image: prom/prometheus:v2.26.0
        args:
        - '--storage.tsdb.retention=360h'
        - '--config.file=/etc/prometheus/prometheus.yml'
        ports:
        - name: web
          containerPort: 9090
        volumeMounts:
        - name: config-volume
          mountPath: /etc/prometheus
        - name: alertrules-volume
          mountPath: /etc/prometheus-rules
      volumes:
      - name: config-volume
        configMap:
          name: prometheus-configmap
      - name: alertrules-volume
        configMap:
          name: prometheus-alertrules
      nodeSelector:
        beta.kubernetes.io/os: linux
apiVersion: v1
kind: Service
metadata:
  annotations:
    prometheus.io/scrape: 'true'
  labels:
    name: prometheus
  name: prometheus
  namespace: monitoring
spec:
  selector:
    app: prometheus
  type: LoadBalancer
  ports:
  - name: prometheus
    protocol: TCP
    port: 9090
    targetPort: 9090
    nodePort: 31090
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-directory-size-metrics
  namespace: monitoring
  annotations:
    description: |
      This `DaemonSet` provides metrics in Prometheus format about disk usage on the nodes.
      The container `read-du` reads in sizes of all directories below /mnt and writes that to `/tmp/metrics`. It only reports directories larger then `100M` for now.
      The other container `caddy` just hands out the contents of that file on request via `http` on `/metrics` at port `9102` which are the defaults for Prometheus.
      These are scheduled on every node in the Kubernetes cluster.
      To choose directories from the node to check, just mount them on the `read-du` container below `/mnt`.
spec:
  selector:
    matchLabels:
      app: node-directory-size-metrics
  template:
    metadata:
      labels:
        app: node-directory-size-metrics
      annotations:
        prometheus.io/scrape: 'true'
        prometheus.io/port: '9102'
        description: |
          This `Pod` provides metrics in Prometheus format about disk usage on the node.
          The container `read-du` reads in sizes of all directories below /mnt and writes that to `/tmp/metrics`. It only reports directories larger then `100M` for now.
          The other container `caddy` just hands out the contents of that file on request on `/metrics` at port `9102` which are the defaults for Prometheus.
          This `Pod` is scheduled on every node in the Kubernetes cluster.
          To choose directories from the node to check just mount them on `read-du` below `/mnt`.
    spec:
      containers:
      - name: read-du
        image: giantswarm/tiny-tools
        imagePullPolicy: Always
        # FIXME threshold via env var
        # The
        command:
        - fish
        - --command
        - |
          while true
            for directory in (du --bytes --separate-dirs --threshold=100M /mnt)
              echo $directory | read size path
              echo "node_directory_size_bytes{path=\"$path\"} $size" \
                >> /tmp/metrics-temp
            end
            mv /tmp/metrics-temp /tmp/metrics
            sleep 300
          end
        volumeMounts:
        - name: host-fs-var
          mountPath: /mnt/var
          readOnly: true
        - name: metrics
          mountPath: /tmp
      - name: caddy
        image: dockermuenster/caddy:0.9.3
        command:
        - "caddy"
        - "-port=9102"
        - "-root=/var/www"
        ports:
        - containerPort: 9102
        volumeMounts:
        - name: metrics
          mountPath: /var/www
      volumes:
      - name: host-fs-var
        hostPath:
          path: /var
      - name: metrics
        emptyDir:
          medium: Memory
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/version: 2.1.0
  name: kube-state-metrics
  namespace: monitoringapiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/version: 2.1.0
  name: kube-state-metrics
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - secrets
  - nodes
  - pods
  - services
  - resourcequotas
  - replicationcontrollers
  - limitranges
  - persistentvolumeclaims
  - persistentvolumes
  - namespaces
  - endpoints
  verbs:
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  - daemonsets
  - deployments
  - replicasets
  verbs:
  - list
  - watch
- apiGroups:
  - batch
  resources:
  - cronjobs
  - jobs
  verbs:
  - list
  - watch
- apiGroups:
  - autoscaling
  resources:
  - horizontalpodautoscalers
  verbs:
  - list
  - watch
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - list
  - watch
- apiGroups:
  - certificates.k8s.io
  resources:
  - certificatesigningrequests
  verbs:
  - list
  - watch
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  - volumeattachments
  verbs:
  - list
  - watch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  - validatingwebhookconfigurations
  verbs:
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - networkpolicies
  - ingresses
  verbs:
  - list
  - watch
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - list
  - watchapiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/version: 2.1.0
  name: kube-state-metrics
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kube-state-metrics
subjects:
- kind: ServiceAccount
  name: kube-state-metrics
  namespace: monitoringapiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/version: 2.1.0
  name: kube-state-metrics
  namespace: monitoring
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: kube-state-metrics
  template:
    metadata:
      labels:
        app.kubernetes.io/name: kube-state-metrics
        app.kubernetes.io/version: 2.1.0
    spec:
      containers:
      - image: k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.1.0
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 5
          timeoutSeconds: 5
        name: kube-state-metrics
        ports:
        - containerPort: 8080
          name: http-metrics
        - containerPort: 8081
          name: telemetry
        readinessProbe:
          httpGet:
            path: /
            port: 8081
          initialDelaySeconds: 5
          timeoutSeconds: 5
        securityContext:
          runAsUser: 65534
      nodeSelector:
        kubernetes.io/os: linux
      serviceAccountName: kube-state-metricsapiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/version: 2.1.0
  name: kube-state-metrics
  namespace: monitoring
spec:
  clusterIP: None
  ports:
  - name: http-metrics
    port: 8080
    targetPort: http-metrics
  - name: telemetry
    port: 8081
    targetPort: telemetry
  selector:
    app.kubernetes.io/name: kube-state-metrics
apiVersion: v1
data:
  prometheus-stats-dashboard.json: |
    {
      "overwrite": true,
      "inputs": [
        {
          "name": "DS_PROMETHEUS",
          "pluginId": "prometheus",
          "type": "datasource",
          "value": "prometheus"
        }
      ],
      "dashboard": {
        "__inputs": [{
          "name": "DS_PROMETHEUS",
          "label": "Prometheus",
          "description": "",
          "type": "datasource",
          "pluginId": "prometheus",
          "pluginName": "Prometheus"
        }],
        "__requires": [{
          "type": "panel",
          "id": "singlestat",
          "name": "Singlestat",
          "version": ""
        }, {
          "type": "panel",
          "id": "text",
          "name": "Text",
          "version": ""
        }, {
          "type": "panel",
          "id": "graph",
          "name": "Graph",
          "version": ""
        }, {
          "type": "grafana",
          "id": "grafana",
          "name": "Grafana",
          "version": "3.1.0"
        }, {
          "type": "datasource",
          "id": "prometheus",
          "name": "Prometheus",
          "version": "1.0.0"
        }],
        "id": null,
        "title": "Prometheus Stats",
        "tags": [],
        "style": "dark",
        "timezone": "browser",
        "editable": true,
        "hideControls": true,
        "sharedCrosshair": false,
        "rows": [{
          "collapse": false,
          "editable": true,
          "height": 178,
          "panels": [{
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": ["rgba(245, 54, 54, 0.9)", "rgba(237, 129, 40, 0.89)", "rgba(50, 172, 45, 0.97)"],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 1,
            "editable": true,
            "error": false,
            "format": "s",
            "id": 5,
            "interval": null,
            "links": [],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "span": 3,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "(time() - process_start_time_seconds{name="prometheus"})",
              "intervalFactor": 2,
              "refId": "A",
              "step": 4
            }],
            "thresholds": "",
            "title": "Uptime",
            "type": "singlestat",
            "valueFontSize": "80%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current",
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "rangeMaps": [{
              "from": "null",
              "to": "null",
              "text": "N/A"
            }],
            "mappingType": 1,
            "gauge": {
              "show": false,
              "minValue": 0,
              "maxValue": 100,
              "thresholdMarkers": true,
              "thresholdLabels": false
            }
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": ["rgba(50, 172, 45, 0.97)", "rgba(237, 129, 40, 0.89)", "rgba(245, 54, 54, 0.9)"],
            "datasource": "${DS_PROMETHEUS}",
            "editable": true,
            "error": false,
            "format": "none",
            "id": 6,
            "interval": null,
            "links": [],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "span": 3,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": true
            },
            "targets": [{
              "expr": "prometheus_local_storage_memory_series",
              "intervalFactor": 2,
              "refId": "A",
              "step": 4
            }],
            "thresholds": "1,5",
            "title": "Local Storage Memory Series",
            "type": "singlestat",
            "valueFontSize": "70%",
            "valueMaps": [],
            "valueName": "current",
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "rangeMaps": [{
              "from": "null",
              "to": "null",
              "text": "N/A"
            }],
            "mappingType": 1,
            "gauge": {
              "show": false,
              "minValue": 0,
              "maxValue": 100,
              "thresholdMarkers": true,
              "thresholdLabels": false
            }
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": true,
            "colors": ["rgba(50, 172, 45, 0.97)", "rgba(237, 129, 40, 0.89)", "rgba(245, 54, 54, 0.9)"],
            "datasource": "${DS_PROMETHEUS}",
            "editable": true,
            "error": false,
            "format": "none",
            "id": 7,
            "interval": null,
            "links": [],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "span": 3,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": true
            },
            "targets": [{
              "expr": "prometheus_local_storage_indexing_queue_length",
              "intervalFactor": 2,
              "refId": "A",
              "step": 4
            }],
            "thresholds": "500,4000",
            "title": "Interal Storage Queue Length",
            "type": "singlestat",
            "valueFontSize": "70%",
            "valueMaps": [{
              "op": "=",
              "text": "Empty",
              "value": "0"
            }],
            "valueName": "current",
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "rangeMaps": [{
              "from": "null",
              "to": "null",
              "text": "N/A"
            }],
            "mappingType": 1,
            "gauge": {
              "show": false,
              "minValue": 0,
              "maxValue": 100,
              "thresholdMarkers": true,
              "thresholdLabels": false
            }
          }, {
            "content": "<img src=\"http://prometheus.io/assets/prometheus_logo_grey.svg\" alt=\"Prometheus logo\" style=\"height: 40px;\">\n<span style=\"font-family: 'Open Sans', 'Helvetica Neue', Helvetica; font-size: 25px;vertical-align: text-top;color: #bbbfc2;margin-left: 10px;\">Prometheus</span>\n\n<p style=\"margin-top: 10px;\">You're using Prometheus, an open-source systems monitoring and alerting toolkit originally built at SoundCloud. For more information, check out the <a href=\"http://www.grafana.org/\">Grafana</a> and <a href=\"http://prometheus.io/\">Prometheus</a> projects.</p>",
            "editable": true,
            "error": false,
            "id": 9,
            "links": [],
            "mode": "html",
            "span": 3,
            "style": {},
            "title": "",
            "transparent": true,
            "type": "text"
          }],
          "title": "New row"
        }, {
          "collapse": false,
          "editable": true,
          "height": 227,
          "panels": [{
            "aliasColors": {
              "prometheus": "#C15C17",
              "{instance=\"localhost:9090\",job=\"prometheus\"}": "#C15C17"
            },
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "editable": true,
            "error": false,
            "fill": 1,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "id": 3,
            "legend": {
              "avg": false,
              "current": false,
              "max": false,
              "min": false,
              "show": true,
              "total": false,
              "values": false
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "connected",
            "percentage": false,
            "pointradius": 2,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 9,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "rate(prometheus_tsdb_head_samples_appended_total[5m])",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{job}}",
              "metric": "",
              "refId": "A",
              "step": 2
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Samples ingested (rate-5m)",
            "tooltip": {
              "shared": true,
              "value_type": "cumulative",
              "ordering": "alphabetical",
              "msResolution": false
            },
            "type": "graph",
            "yaxes": [{
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "short"
            }, {
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "short"
            }],
            "xaxis": {
              "show": true
            }
          }, {
            "content": "#### Samples Ingested\nThis graph displays the count of samples ingested by the Prometheus server, as measured over the last 5 minutes, per time series in the range vector. When troubleshooting an issue on IRC or Github, this is often the first stat requested by the Prometheus team. ",
            "editable": true,
            "error": false,
            "id": 8,
            "links": [],
            "mode": "markdown",
            "span": 2.995914043583536,
            "style": {},
            "title": "",
            "transparent": true,
            "type": "text"
          }],
          "title": "New row"
        }, {
          "collapse": false,
          "editable": true,
          "height": "250px",
          "panels": [{
            "aliasColors": {
              "prometheus": "#F9BA8F",
              "{instance=\"localhost:9090\",interval=\"5s\",job=\"prometheus\"}": "#F9BA8F"
            },
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "editable": true,
            "error": false,
            "fill": 1,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "id": 2,
            "legend": {
              "avg": false,
              "current": false,
              "max": false,
              "min": false,
              "show": true,
              "total": false,
              "values": false
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "connected",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 5,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "rate(prometheus_target_interval_length_seconds_count[5m])",
              "intervalFactor": 2,
              "legendFormat": "{{job}}",
              "refId": "A",
              "step": 2
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Target Scrapes (last 5m)",
            "tooltip": {
              "shared": true,
              "value_type": "cumulative",
              "ordering": "alphabetical",
              "msResolution": false
            },
            "type": "graph",
            "yaxes": [{
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "short"
            }, {
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "short"
            }],
            "xaxis": {
              "show": true
            }
          }, {
            "aliasColors": {},
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "editable": true,
            "error": false,
            "fill": 1,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "id": 14,
            "legend": {
              "avg": false,
              "current": false,
              "max": false,
              "min": false,
              "show": true,
              "total": false,
              "values": false
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "connected",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 4,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "prometheus_target_interval_length_seconds{quantile!=\"0.01\", quantile!=\"0.05\"}",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{quantile}} ({{interval}})",
              "metric": "",
              "refId": "A",
              "step": 2
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Scrape Duration",
            "tooltip": {
              "shared": true,
              "value_type": "cumulative",
              "ordering": "alphabetical",
              "msResolution": false
            },
            "type": "graph",
            "yaxes": [{
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "short"
            }, {
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "short"
            }],
            "xaxis": {
              "show": true
            }
          }, {
            "content": "#### Scrapes\nPrometheus scrapes metrics from instrumented jobs, either directly or via an intermediary push gateway for short-lived jobs. Target scrapes will show how frequently targets are scraped, as measured over the last 5 minutes, per time series in the range vector. Scrape Duration will show how long the scrapes are taking, with percentiles available as series. ",
            "editable": true,
            "error": false,
            "id": 11,
            "links": [],
            "mode": "markdown",
            "span": 3,
            "style": {},
            "title": "",
            "transparent": true,
            "type": "text"
          }],
          "title": "New row"
        }, {
          "collapse": false,
          "editable": true,
          "height": "250px",
          "panels": [{
            "aliasColors": {},
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "decimals": null,
            "editable": true,
            "error": false,
            "fill": 1,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "id": 12,
            "legend": {
              "alignAsTable": false,
              "avg": false,
              "current": false,
              "hideEmpty": true,
              "max": false,
              "min": false,
              "show": true,
              "total": false,
              "values": false
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "connected",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 9,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "prometheus_evaluator_duration_milliseconds{quantile!=\"0.01\", quantile!=\"0.05\"}",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{quantile}}",
              "refId": "A",
              "step": 2
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Rule Eval Duration",
            "tooltip": {
              "shared": true,
              "value_type": "cumulative",
              "ordering": "alphabetical",
              "msResolution": false
            },
            "type": "graph",
            "yaxes": [{
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "percentunit",
              "label": ""
            }, {
              "show": true,
              "min": null,
              "max": null,
              "logBase": 1,
              "format": "short"
            }],
            "xaxis": {
              "show": true
            }
          }, {
            "content": "#### Rule Evaluation Duration\nThis graph panel plots the duration for all evaluations to execute. The 50th percentile, 90th percentile and 99th percentile are shown as three separate series to help identify outliers that may be skewing the data.",
            "editable": true,
            "error": false,
            "id": 15,
            "links": [],
            "mode": "markdown",
            "span": 3,
            "style": {},
            "title": "",
            "transparent": true,
            "type": "text"
          }],
          "title": "New row"
        }],
        "time": {
          "from": "now-5m",
          "to": "now"
        },
        "timepicker": {
          "now": true,
          "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"],
          "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"]
        },
        "templating": {
          "list": []
        },
        "annotations": {
          "list": []
        },
        "refresh": false,
        "schemaVersion": 12,
        "version": 0,
        "links": [{
          "icon": "info",
          "tags": [],
          "targetBlank": true,
          "title": "Grafana Docs",
          "tooltip": "",
          "type": "link",
          "url": "http://www.grafana.org/docs"
        }, {
          "icon": "info",
          "tags": [],
          "targetBlank": true,
          "title": "Prometheus Docs",
          "type": "link",
          "url": "http://prometheus.io/docs/introduction/overview/"
        }],
        "gnetId": 2,
        "description": "The  official, pre-built Prometheus Stats Dashboard."
      }
    }
  k8s-pod-resources-dashboard.json: |
    {
      "overwrite": true,
      "inputs": [
        {
          "name": "DS_PROMETHEUS",
          "pluginId": "prometheus",
          "type": "datasource",
          "value": "prometheus"
        }
      ],
      "dashboard": {
        "__inputs": [{
          "name": "DS_PROMETHEUS",
          "label": "prometheus",
          "description": "",
          "type": "datasource",
          "pluginId": "prometheus",
          "pluginName": "Prometheus"
        }],
        "__requires": [{
          "type": "panel",
          "id": "singlestat",
          "name": "Singlestat",
          "version": ""
        }, {
          "type": "panel",
          "id": "graph",
          "name": "Graph",
          "version": ""
        }, {
          "type": "grafana",
          "id": "grafana",
          "name": "Grafana",
          "version": "3.1.0"
        }, {
          "type": "datasource",
          "id": "prometheus",
          "name": "Prometheus",
          "version": "1.0.0"
        }],
        "id": null,
        "title": "Kubernetes Pod Resources",
        "description": "Shows resource usage of Kubernetes pods.",
        "tags": [
          "kubernetes"
        ],
        "style": "dark",
        "timezone": "browser",
        "editable": true,
        "hideControls": false,
        "sharedCrosshair": false,
        "rows": [{
          "collapse": false,
          "editable": true,
          "height": "250px",
          "panels": [{
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": true,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "editable": true,
            "error": false,
            "format": "percent",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": true,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "180px",
            "id": 4,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 4,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum (container_memory_working_set_bytes{id=\"/\",instance=~\"^$instance$\"}) / sum (machine_memory_bytes{instance=~\"^$instance$\"}) * 100",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "",
              "refId": "A",
              "step": 2
            }],
            "thresholds": "65, 90",
            "timeFrom": "1m",
            "timeShift": null,
            "title": "Memory Working Set",
            "transparent": false,
            "type": "singlestat",
            "valueFontSize": "80%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": true,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "percent",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": true,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "180px",
            "id": 6,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 4,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum(rate(container_cpu_usage_seconds_total{id=\"/\",instance=~\"^$instance$\"}[1m])) / sum (machine_cpu_cores{instance=~\"^$instance$\"}) * 100",
              "interval": "10s",
              "intervalFactor": 1,
              "refId": "A",
              "step": 10
            }],
            "thresholds": "65, 90",
            "timeFrom": "1m",
            "timeShift": null,
            "title": "Cpu Usage",
            "type": "singlestat",
            "valueFontSize": "80%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": true,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "percent",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": true,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "180px",
            "id": 7,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 4,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum(container_fs_usage_bytes{id=\"/\",instance=~\"^$instance$\"}) / sum(container_fs_limit_bytes{id=\"/\",instance=~\"^$instance$\"}) * 100",
              "interval": "10s",
              "intervalFactor": 1,
              "legendFormat": "",
              "metric": "",
              "refId": "A",
              "step": 10
            }],
            "thresholds": "65, 90",
            "timeFrom": "1m",
            "timeShift": null,
            "title": "Filesystem Usage",
            "type": "singlestat",
            "valueFontSize": "80%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "bytes",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "1px",
            "hideTimeOverride": true,
            "id": 9,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "20%",
            "prefix": "",
            "prefixFontSize": "20%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 2,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum(container_memory_working_set_bytes{id=\"/\",instance=~\"^$instance$\"})",
              "interval": "10s",
              "intervalFactor": 1,
              "refId": "A",
              "step": 10
            }],
            "thresholds": "",
            "timeFrom": "1m",
            "title": "Used",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "bytes",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "1px",
            "hideTimeOverride": true,
            "id": 10,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 2,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum (machine_memory_bytes{instance=~\"^$instance$\"})",
              "interval": "10s",
              "intervalFactor": 1,
              "refId": "A",
              "step": 10
            }],
            "thresholds": "",
            "timeFrom": "1m",
            "title": "Total",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "none",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "1px",
            "hideTimeOverride": true,
            "id": 11,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": " cores",
            "postfixFontSize": "30%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 2,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum (rate (container_cpu_usage_seconds_total{id=\"/\",instance=~\"^$instance$\"}[1m]))",
              "interval": "10s",
              "intervalFactor": 1,
              "refId": "A",
              "step": 10
            }],
            "thresholds": "",
            "timeFrom": "1m",
            "timeShift": null,
            "title": "Used",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "none",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "1px",
            "hideTimeOverride": true,
            "id": 12,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": " cores",
            "postfixFontSize": "30%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 2,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum (machine_cpu_cores{instance=~\"^$instance$\"})",
              "interval": "10s",
              "intervalFactor": 1,
              "refId": "A",
              "step": 10
            }],
            "thresholds": "",
            "timeFrom": "1m",
            "title": "Total",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "bytes",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "1px",
            "hideTimeOverride": true,
            "id": 13,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 2,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum(container_fs_usage_bytes{id=\"/\",instance=~\"^$instance$\"})",
              "interval": "10s",
              "intervalFactor": 1,
              "refId": "A",
              "step": 10
            }],
            "thresholds": "",
            "timeFrom": "1m",
            "title": "Used",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "format": "bytes",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "height": "1px",
            "hideTimeOverride": true,
            "id": 14,
            "interval": null,
            "isNew": true,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [{
              "name": "value to text",
              "value": 1
            }, {
              "name": "range to text",
              "value": 2
            }],
            "maxDataPoints": 100,
            "nullPointMode": "connected",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [{
              "from": "null",
              "text": "N/A",
              "to": "null"
            }],
            "span": 2,
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "targets": [{
              "expr": "sum (container_fs_limit_bytes{id=\"/\",instance=~\"^$instance$\"})",
              "interval": "10s",
              "intervalFactor": 1,
              "refId": "A",
              "step": 10
            }],
            "thresholds": "",
            "timeFrom": "1m",
            "title": "Total",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [{
              "op": "=",
              "text": "N/A",
              "value": "null"
            }],
            "valueName": "current"
          }, {
            "aliasColors": {},
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "fill": 1,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)",
              "thresholdLine": false
            },
            "height": "200px",
            "id": 32,
            "isNew": true,
            "legend": {
              "alignAsTable": true,
              "avg": true,
              "current": true,
              "max": false,
              "min": false,
              "rightSide": true,
              "show": true,
              "sideWidth": 200,
              "sort": "current",
              "sortDesc": true,
              "total": false,
              "values": true
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "connected",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 12,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "sum(rate(container_network_receive_bytes_total{instance=~\"^$instance$\",namespace=~\"^$namespace$\"}[1m]))",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "receive",
              "metric": "network",
              "refId": "A",
              "step": 240
            }, {
              "expr": "- sum(rate(container_network_transmit_bytes_total{instance=~\"^$instance$\",namespace=~\"^$namespace$\"}[1m]))",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "transmit",
              "metric": "network",
              "refId": "B",
              "step": 240
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Network",
            "tooltip": {
              "msResolution": false,
              "shared": true,
              "sort": 0,
              "value_type": "cumulative"
            },
            "transparent": false,
            "type": "graph",
            "xaxis": {
              "show": true
            },
            "yaxes": [{
              "format": "Bps",
              "label": "transmit / receive",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }, {
              "format": "Bps",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }]
          }],
          "showTitle": true,
          "title": "all pods"
        }, {
          "collapse": false,
          "editable": true,
          "height": "250px",
          "panels": [{
            "aliasColors": {},
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 3,
            "editable": true,
            "error": false,
            "fill": 0,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "height": "",
            "id": 17,
            "isNew": true,
            "legend": {
              "alignAsTable": true,
              "avg": true,
              "current": true,
              "hideEmpty": true,
              "hideZero": true,
              "max": false,
              "min": false,
              "rightSide": true,
              "show": true,
              "sideWidth": null,
              "sort": "current",
              "sortDesc": true,
              "total": false,
              "values": true
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "connected",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 12,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "sum(rate(container_cpu_usage_seconds_total{image!=\"\",name=~\"^k8s_.*\",instance=~\"^$instance$\",namespace=~\"^$namespace$\"}[1m])) by (pod_name)",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ pod_name }}",
              "metric": "container_cpu",
              "refId": "A",
              "step": 240
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Cpu Usage",
            "tooltip": {
              "msResolution": true,
              "shared": false,
              "sort": 2,
              "value_type": "cumulative"
            },
            "transparent": false,
            "type": "graph",
            "xaxis": {
              "show": true
            },
            "yaxes": [{
              "format": "none",
              "label": "cores",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }, {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }]
          }, {
            "aliasColors": {},
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "fill": 0,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "id": 33,
            "isNew": true,
            "legend": {
              "alignAsTable": true,
              "avg": true,
              "current": true,
              "hideEmpty": true,
              "hideZero": true,
              "max": false,
              "min": false,
              "rightSide": true,
              "show": true,
              "sideWidth": null,
              "sort": "current",
              "sortDesc": true,
              "total": false,
              "values": true
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "null",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 12,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "sum (container_memory_working_set_bytes{image!=\"\",name=~\"^k8s_.*\",instance=~\"^$instance$\",namespace=~\"^$namespace$\"}) by (pod_name)",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ pod_name }}",
              "metric": "",
              "refId": "A",
              "step": 240
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Memory Working Set",
            "tooltip": {
              "msResolution": false,
              "shared": false,
              "sort": 2,
              "value_type": "cumulative"
            },
            "type": "graph",
            "xaxis": {
              "show": true
            },
            "yaxes": [{
              "format": "bytes",
              "label": "used",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }, {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }]
          }, {
            "aliasColors": {},
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "fill": 1,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "id": 16,
            "isNew": true,
            "legend": {
              "alignAsTable": true,
              "avg": true,
              "current": true,
              "hideEmpty": true,
              "hideZero": true,
              "max": false,
              "min": false,
              "rightSide": true,
              "show": true,
              "sideWidth": 200,
              "sort": "avg",
              "sortDesc": true,
              "total": false,
              "values": true
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "null",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 12,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "sum (rate (container_network_receive_bytes_total{image!=\"\",name=~\"^k8s_.*\",instance=~\"^$instance$\",namespace=~\"^$namespace$\"}[1m])) by (pod_name)",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ pod_name }} < in",
              "metric": "network",
              "refId": "A",
              "step": 240
            }, {
              "expr": "- sum (rate (container_network_transmit_bytes_total{image!=\"\",name=~\"^k8s_.*\",instance=~\"^$instance$\",namespace=~\"^$namespace$\"}[1m])) by (pod_name)",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ pod_name }} > out",
              "metric": "network",
              "refId": "B",
              "step": 240
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Network",
            "tooltip": {
              "msResolution": false,
              "shared": false,
              "sort": 2,
              "value_type": "cumulative"
            },
            "type": "graph",
            "xaxis": {
              "show": true
            },
            "yaxes": [{
              "format": "Bps",
              "label": "transmit / receive",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }, {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }]
          }, {
            "aliasColors": {},
            "bars": false,
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 2,
            "editable": true,
            "error": false,
            "fill": 1,
            "grid": {
              "threshold1": null,
              "threshold1Color": "rgba(216, 200, 27, 0.27)",
              "threshold2": null,
              "threshold2Color": "rgba(234, 112, 112, 0.22)"
            },
            "id": 34,
            "isNew": true,
            "legend": {
              "alignAsTable": true,
              "avg": true,
              "current": true,
              "hideEmpty": true,
              "hideZero": true,
              "max": false,
              "min": false,
              "rightSide": true,
              "show": true,
              "sideWidth": 200,
              "sort": "current",
              "sortDesc": true,
              "total": false,
              "values": true
            },
            "lines": true,
            "linewidth": 2,
            "links": [],
            "nullPointMode": "null",
            "percentage": false,
            "pointradius": 5,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "span": 12,
            "stack": false,
            "steppedLine": false,
            "targets": [{
              "expr": "sum(container_fs_usage_bytes{image!=\"\",name=~\"^k8s_.*\",instance=~\"^$instance$\",namespace=~\"^$namespace$\"}) by (pod_name)",
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ pod_name }}",
              "metric": "network",
              "refId": "A",
              "step": 240
            }],
            "timeFrom": null,
            "timeShift": null,
            "title": "Filesystem",
            "tooltip": {
              "msResolution": false,
              "shared": false,
              "sort": 2,
              "value_type": "cumulative"
            },
            "type": "graph",
            "xaxis": {
              "show": true
            },
            "yaxes": [{
              "format": "bytes",
              "label": "used",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }, {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }]
          }],
          "showTitle": true,
          "title": "each pod"
        }],
        "time": {
          "from": "now-3d",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
          ],
          "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
          ]
        },
        "templating": {
          "list": [{
            "allValue": ".*",
            "current": {},
            "datasource": "${DS_PROMETHEUS}",
            "hide": 0,
            "includeAll": true,
            "label": "Instance",
            "multi": false,
            "name": "instance",
            "options": [],
            "query": "label_values(instance)",
            "refresh": 1,
            "regex": "",
            "type": "query"
          }, {
            "current": {},
            "datasource": "${DS_PROMETHEUS}",
            "hide": 0,
            "includeAll": true,
            "label": "Namespace",
            "multi": true,
            "name": "namespace",
            "options": [],
            "query": "label_values(namespace)",
            "refresh": 1,
            "regex": "",
            "type": "query"
          }]
        },
        "annotations": {
          "list": []
        },
        "refresh": false,
        "schemaVersion": 12,
        "version": 8,
        "links": [],
        "gnetId": 737
      }
    }
  sock-shop-resources-dashboard.json: |
    {
      "overwrite": true,
      "inputs": [
        {
          "name": "DS_PROMETHEUS",
          "pluginId": "prometheus",
          "type": "datasource",
          "value": "prometheus"
        }
      ],
      "dashboard": {
        "__inputs": [
          {
            "name": "DS_PROMETHEUS",
            "label": "prometheus",
            "description": "",
            "type": "datasource",
            "pluginId": "prometheus",
            "pluginName": "Prometheus"
          }
        ],
        "__requires": [
          {
            "type": "grafana",
            "id": "grafana",
            "name": "Grafana",
            "version": "4.1.2"
          },
          {
            "type": "panel",
            "id": "graph",
            "name": "Graph",
            "version": ""
          },
          {
            "type": "datasource",
            "id": "prometheus",
            "name": "Prometheus",
            "version": "1.0.0"
          },
          {
            "type": "panel",
            "id": "singlestat",
            "name": "Singlestat",
            "version": ""
          }
        ],
        "annotations": {
          "list": []
        },
        "editable": true,
        "gnetId": null,
        "graphTooltip": 0,
        "hideControls": false,
        "id": null,
        "links": [],
        "refresh": "10s",
        "rows": [
          {
            "collapse": false,
            "height": -250,
            "panels": [
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": true,
                "colors": [
                  "rgba(50, 172, 45, 0.97)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(245, 54, 54, 0.9)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "editable": true,
                "error": false,
                "format": "percent",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": true,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "height": "180px",
                "id": 2,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": "",
                "postfixFontSize": "50%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 6,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "sum (container_memory_working_set_bytes{namespace=\"sock-shop\"}) / sum (machine_memory_bytes{}) * 100",
                    "interval": "",
                    "intervalFactor": 2,
                    "legendFormat": "",
                    "refId": "A",
                    "step": 2
                  }
                ],
                "thresholds": "65, 90",
                "timeFrom": "1m",
                "timeShift": null,
                "title": "Memory",
                "transparent": false,
                "type": "singlestat",
                "valueFontSize": "80%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              },
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": true,
                "colors": [
                  "rgba(50, 172, 45, 0.97)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(245, 54, 54, 0.9)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "decimals": 2,
                "editable": true,
                "error": false,
                "format": "percent",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": true,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "height": "180px",
                "id": 6,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": "",
                "postfixFontSize": "50%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 6,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"sock-shop\"}[1m])) / sum (machine_cpu_cores) * 100",
                    "interval": "10s",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 10
                  }
                ],
                "thresholds": "65, 90",
                "timeFrom": "1m",
                "timeShift": null,
                "title": "Cpu Usage",
                "type": "singlestat",
                "valueFontSize": "80%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              },
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": false,
                "colors": [
                  "rgba(50, 172, 45, 0.97)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(245, 54, 54, 0.9)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "decimals": 2,
                "editable": true,
                "error": false,
                "format": "bytes",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": false,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "height": "1px",
                "hideTimeOverride": true,
                "id": 4,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": "",
                "postfixFontSize": "20%",
                "prefix": "",
                "prefixFontSize": "20%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 3,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "sum(container_memory_working_set_bytes{namespace=\"sock-shop\"})",
                    "interval": "10s",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 10
                  }
                ],
                "thresholds": "",
                "timeFrom": "1m",
                "title": "Used",
                "type": "singlestat",
                "valueFontSize": "50%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              },
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": false,
                "colors": [
                  "rgba(50, 172, 45, 0.97)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(245, 54, 54, 0.9)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "decimals": 2,
                "editable": true,
                "error": false,
                "format": "bytes",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": false,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "height": "1px",
                "hideTimeOverride": true,
                "id": 5,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": "",
                "postfixFontSize": "50%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 3,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "sum (machine_memory_bytes)",
                    "interval": "10s",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 10
                  }
                ],
                "thresholds": "",
                "timeFrom": "1m",
                "title": "Total",
                "type": "singlestat",
                "valueFontSize": "50%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              },
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": false,
                "colors": [
                  "rgba(50, 172, 45, 0.97)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(245, 54, 54, 0.9)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "decimals": 2,
                "editable": true,
                "error": false,
                "format": "none",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": false,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "height": "1px",
                "hideTimeOverride": true,
                "id": 7,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": " cores",
                "postfixFontSize": "30%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 3,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "sum (rate (container_cpu_usage_seconds_total{namespace=\"sock-shop\"}[1m]))",
                    "interval": "10s",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 10
                  }
                ],
                "thresholds": "",
                "timeFrom": "1m",
                "timeShift": null,
                "title": "Used",
                "type": "singlestat",
                "valueFontSize": "50%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              },
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": false,
                "colors": [
                  "rgba(50, 172, 45, 0.97)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(245, 54, 54, 0.9)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "decimals": 2,
                "editable": true,
                "error": false,
                "format": "none",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": false,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "height": "1px",
                "hideTimeOverride": true,
                "id": 8,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": " cores",
                "postfixFontSize": "30%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 3,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "sum (machine_cpu_cores)",
                    "interval": "10s",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 10
                  }
                ],
                "thresholds": "",
                "timeFrom": "1m",
                "title": "Total",
                "type": "singlestat",
                "valueFontSize": "50%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": 227,
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "decimals": 2,
                "editable": true,
                "error": false,
                "fill": 0,
                "grid": {},
                "id": 10,
                "legend": {
                  "alignAsTable": true,
                  "avg": true,
                  "current": true,
                  "hideEmpty": true,
                  "hideZero": true,
                  "max": false,
                  "min": false,
                  "rightSide": true,
                  "show": true,
                  "sideWidth": null,
                  "sort": "current",
                  "sortDesc": true,
                  "total": false,
                  "values": true
                },
                "lines": true,
                "linewidth": 2,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 12,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum (container_memory_working_set_bytes{namespace=\"sock-shop\"}) by (pod_name)",
                    "interval": "",
                    "intervalFactor": 2,
                    "legendFormat": "{{ pod_name }}",
                    "metric": "",
                    "refId": "A",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "timeFrom": null,
                "timeShift": null,
                "title": "Memory Working Set",
                "tooltip": {
                  "msResolution": false,
                  "shared": false,
                  "sort": 2,
                  "value_type": "cumulative"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "bytes",
                    "label": "used",
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": false
                  }
                ]
              }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": 250,
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "decimals": 3,
                "editable": true,
                "error": false,
                "fill": 0,
                "grid": {},
                "height": "",
                "id": 9,
                "legend": {
                  "alignAsTable": true,
                  "avg": true,
                  "current": true,
                  "hideEmpty": true,
                  "hideZero": true,
                  "max": false,
                  "min": false,
                  "rightSide": true,
                  "show": true,
                  "sideWidth": null,
                  "sort": "current",
                  "sortDesc": true,
                  "total": false,
                  "values": true
                },
                "lines": true,
                "linewidth": 2,
                "links": [],
                "nullPointMode": "connected",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 12,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"sock-shop\"}[1m])) by (pod_name)",
                    "interval": "",
                    "intervalFactor": 2,
                    "legendFormat": "{{ pod_name }}",
                    "metric": "container_cpu",
                    "refId": "A",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "timeFrom": null,
                "timeShift": null,
                "title": "Cpu Usage",
                "tooltip": {
                  "msResolution": true,
                  "shared": false,
                  "sort": 2,
                  "value_type": "cumulative"
                },
                "transparent": false,
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "none",
                    "label": "cores",
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": false
                  }
                ]
              }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          }
        ],
        "schemaVersion": 14,
        "style": "dark",
        "tags": [],
        "templating": {
          "list": []
        },
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
          ],
          "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
          ]
        },
        "timezone": "browser",
        "title": "Sock-Shop Resources",
        "version": 7
      }
    }
  sock-shop-performance-dashboard.json: |
    {
      "overwrite": true,
      "inputs": [
        {
          "name": "DS_PROMETHEUS",
          "pluginId": "prometheus",
          "type": "datasource",
          "value": "prometheus"
        }
      ],
      "dashboard": {
        "__inputs": [
          {
            "name": "DS_PROMETHEUS",
            "label": "prometheus",
            "description": "",
            "type": "datasource",
            "pluginId": "prometheus",
            "pluginName": "Prometheus"
          }
        ],
        "__requires": [
          {
            "type": "grafana",
            "id": "grafana",
            "name": "Grafana",
            "version": "4.1.2"
          },
          {
            "type": "panel",
            "id": "graph",
            "name": "Graph",
            "version": ""
          },
          {
            "type": "datasource",
            "id": "prometheus",
            "name": "Prometheus",
            "version": "1.0.0"
          }
        ],
        "annotations": {
          "list": []
        },
        "editable": true,
        "graphTooltip": 0,
        "hideControls": false,
        "links": [],
        "refresh": "5s",
        "rows": [
          {
            "collapse": false,
            "height": "250px",
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 1,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"catalogue\",status_code=~\"2..\",route!=\"metrics\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "2xx",
                    "refId": "A",
                    "step": 4
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"catalogue\",status_code=~\"4.+|5.+\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "4xx/5xx",
                    "refId": "B",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "title": "Catalogue QPS",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "ops",
                    "label": "QPS (1 min)",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              },
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 2,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "histogram_quantile(0.99, sum(rate(request_duration_seconds_bucket{name=\"catalogue\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "99th quantile",
                    "refId": "A",
                    "step": 2
                  },
                  {
                    "expr": "histogram_quantile(0.5, sum(rate(request_duration_seconds_bucket{name=\"catalogue\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "50th quantile",
                    "refId": "B",
                    "step": 2
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_sum{name=\"catalogue\"}[1m])) / sum(rate(request_duration_seconds_count{name=\"catalogue\"}[1m]))",
                    "intervalFactor": 2,
                    "legendFormat": "Mean",
                    "refId": "C",
                    "step": 2
                  }
                ],
                "thresholds": [],
                "title": "Catalogue latency",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "s",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              }
            ],
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": "250px",
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 3,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"carts\",status_code=~\"2..\",route!=\"metrics\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "2xx",
                    "refId": "A",
                    "step": 4
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"carts\",status_code=~\"4.+|5.+\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "4xx/5xx",
                    "refId": "B",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "title": "Cart QPS",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "ops",
                    "label": "QPS (1 min)",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              },
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 4,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "histogram_quantile(0.99, sum(rate(request_duration_seconds_bucket{name=\"carts\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "99th quantile",
                    "refId": "A",
                    "step": 2
                  },
                  {
                    "expr": "histogram_quantile(0.5, sum(rate(request_duration_seconds_bucket{name=\"carts\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "50th quantile",
                    "refId": "B",
                    "step": 2
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_sum{name=\"carts\"}[1m])) / sum(rate(request_duration_seconds_count{name=\"carts\"}[1m]))",
                    "intervalFactor": 2,
                    "legendFormat": "Mean",
                    "refId": "C",
                    "step": 2
                  }
                ],
                "thresholds": [],
                "title": "Cart latency",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "s",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              }
            ],
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": "250px",
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 5,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"orders\",status_code=~\"2..\",route!=\"metrics\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "2xx",
                    "refId": "A",
                    "step": 4
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"orders\",status_code=~\"4.+|5.+\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "4xx/5xx",
                    "refId": "B",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "title": "Orders QPS",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "ops",
                    "label": "QPS (1 min)",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              },
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 6,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "histogram_quantile(0.99, sum(rate(request_duration_seconds_bucket{name=\"orders\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "99th quantile",
                    "refId": "A",
                    "step": 2
                  },
                  {
                    "expr": "histogram_quantile(0.5, sum(rate(request_duration_seconds_bucket{name=\"orders\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "50th quantile",
                    "refId": "B",
                    "step": 2
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_sum{name=\"orders\"}[1m])) / sum(rate(request_duration_seconds_count{name=\"orders\"}[1m]))",
                    "intervalFactor": 2,
                    "legendFormat": "Mean",
                    "refId": "C",
                    "step": 2
                  }
                ],
                "thresholds": [],
                "title": "Orders latency",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "s",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              }
            ],
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": "250px",
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 7,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"payment\",status_code=~\"2..\",route!=\"metrics\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "2xx",
                    "refId": "A",
                    "step": 4
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"payment\",status_code=~\"4.+|5.+\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "4xx/5xx",
                    "refId": "B",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "title": "Payment QPS",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "ops",
                    "label": "QPS (1 min)",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              },
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 8,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "histogram_quantile(0.99, sum(rate(request_duration_seconds_bucket{name=\"payment\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "99th quantile",
                    "refId": "A",
                    "step": 2
                  },
                  {
                    "expr": "histogram_quantile(0.5, sum(rate(request_duration_seconds_bucket{name=\"payment\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "50th quantile",
                    "refId": "B",
                    "step": 2
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_sum{name=\"payment\"}[1m])) / sum(rate(request_duration_seconds_count{name=\"payment\"}[1m]))",
                    "intervalFactor": 2,
                    "legendFormat": "Mean",
                    "refId": "C",
                    "step": 2
                  }
                ],
                "thresholds": [],
                "title": "Payment latency",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "s",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              }
            ],
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": "250px",
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 9,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"shipping\",status_code=~\"2..\",route!=\"metrics\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "2xx",
                    "refId": "A",
                    "step": 4
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"shipping\",status_code=~\"4.+|5.+\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "4xx/5xx",
                    "refId": "B",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "title": "Shipping QPS",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "ops",
                    "label": "QPS (1 min)",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              },
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 10,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "histogram_quantile(0.99, sum(rate(request_duration_seconds_bucket{name=\"shipping\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "99th quantile",
                    "refId": "A",
                    "step": 2
                  },
                  {
                    "expr": "histogram_quantile(0.5, sum(rate(request_duration_seconds_bucket{name=\"shipping\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "50th quantile",
                    "refId": "B",
                    "step": 2
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_sum{name=\"shipping\"}[1m])) / sum(rate(request_duration_seconds_count{name=\"shipping\"}[1m]))",
                    "intervalFactor": 2,
                    "legendFormat": "Mean",
                    "refId": "C",
                    "step": 2
                  }
                ],
                "thresholds": [],
                "title": "Shipping latency",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "s",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              }
            ],
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": "250px",
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 11,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"user\",status_code=~\"2..\",route!=\"metrics\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "2xx",
                    "refId": "A",
                    "step": 4
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"user\",status_code=~\"4.+|5.+\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "4xx/5xx",
                    "refId": "B",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "title": "User QPS",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "ops",
                    "label": "QPS (1 min)",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              },
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 12,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "histogram_quantile(0.99, sum(rate(request_duration_seconds_bucket{name=\"user\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "99th quantile",
                    "refId": "A",
                    "step": 2
                  },
                  {
                    "expr": "histogram_quantile(0.5, sum(rate(request_duration_seconds_bucket{name=\"user\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "50th quantile",
                    "refId": "B",
                    "step": 2
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_sum{name=\"user\"}[1m])) / sum(rate(request_duration_seconds_count{name=\"user\"}[1m]))",
                    "intervalFactor": 2,
                    "legendFormat": "Mean",
                    "refId": "C",
                    "step": 2
                  }
                ],
                "thresholds": [],
                "title": "User latency",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "s",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              }
            ],
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          },
          {
            "collapse": false,
            "height": "250px",
            "panels": [
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 13,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"front-end\",status_code=~\"2..\",route!=\"metrics\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "2xx",
                    "refId": "A",
                    "step": 4
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_count{name=\"front-end\",status_code=~\"4.+|5.+\"}[1m])) * 100",
                    "intervalFactor": 2,
                    "legendFormat": "4xx/5xx",
                    "refId": "B",
                    "step": 4
                  }
                ],
                "thresholds": [],
                "title": "Frontend QPS",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "ops",
                    "label": "QPS (1 min)",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              },
              {
                "aliasColors": {},
                "bars": false,
                "datasource": "${DS_PROMETHEUS}",
                "fill": 1,
                "id": 14,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "links": [],
                "nullPointMode": "null",
                "percentage": false,
                "pointradius": 5,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "span": 6,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "expr": "histogram_quantile(0.99, sum(rate(request_duration_seconds_bucket{name=\"front-end\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "99th quantile",
                    "refId": "A",
                    "step": 2
                  },
                  {
                    "expr": "histogram_quantile(0.5, sum(rate(request_duration_seconds_bucket{name=\"front-end\"}[1m])) by (name, le))",
                    "intervalFactor": 2,
                    "legendFormat": "50th quantile",
                    "refId": "B",
                    "step": 2
                  },
                  {
                    "expr": "sum(rate(request_duration_seconds_sum{name=\"front-end\"}[1m])) / sum(rate(request_duration_seconds_count{name=\"front-end\"}[1m]))",
                    "intervalFactor": 2,
                    "legendFormat": "Mean",
                    "refId": "C",
                    "step": 2
                  }
                ],
                "thresholds": [],
                "title": "Frontend latency",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "mode": "time",
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "s",
                    "logBase": 1,
                    "min": 0,
                    "show": true
                  },
                  {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ]
              }
            ],
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          }
        ],
        "schemaVersion": 14,
        "style": "dark",
        "tags": [],
        "templating": {
          "list": []
        },
        "time": {
          "from": "now-30m",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
          ],
          "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
          ]
        },
        "timezone": "browser",
        "title": "Sock-Shop Performance",
        "version": 4
      }
    }
  sock-shop-analytics-dashboard.json: |
    {
      "overwrite": true,
      "inputs": [
        {
          "name": "DS_PROMETHEUS",
          "pluginId": "prometheus",
          "type": "datasource",
          "value": "prometheus"
        }
      ],
      "dashboard": {
        "__inputs": [
          {
            "name": "DS_PROMETHEUS",
            "label": "prometheus",
            "description": "",
            "type": "datasource",
            "pluginId": "prometheus",
            "pluginName": "Prometheus"
          }
        ],
        "__requires": [
          {
            "type": "grafana",
            "id": "grafana",
            "name": "Grafana",
            "version": "4.1.2"
          },
          {
            "type": "datasource",
            "id": "prometheus",
            "name": "Prometheus",
            "version": "1.0.0"
          },
          {
            "type": "panel",
            "id": "singlestat",
            "name": "Singlestat",
            "version": ""
          }
        ],
        "annotations": {
          "list": []
        },
        "editable": true,
        "gnetId": null,
        "graphTooltip": 0,
        "hideControls": false,
        "id": null,
        "links": [],
        "rows": [
          {
            "collapse": false,
            "height": 190,
            "panels": [
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": false,
                "colors": [
                  "rgba(245, 54, 54, 0.9)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(50, 172, 45, 0.97)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "format": "none",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": false,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "id": 1,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": "",
                "postfixFontSize": "50%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 2,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "request_duration_seconds_count{name=\"orders\",method=\"POST\"}",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 30
                  }
                ],
                "thresholds": "",
                "title": "# Orders",
                "type": "singlestat",
                "valueFontSize": "80%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              },
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": false,
                "colors": [
                  "rgba(245, 54, 54, 0.9)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(50, 172, 45, 0.97)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "format": "none",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": false,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "id": 2,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": "",
                "postfixFontSize": "50%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 5,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "rate(request_duration_seconds_count{name=\"orders\",method=\"POST\"}[1h]) *24*60*60",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 30
                  }
                ],
                "thresholds": "",
                "title": "Projected number of orders per day",
                "type": "singlestat",
                "valueFontSize": "80%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              },
              {
                "cacheTimeout": null,
                "colorBackground": false,
                "colorValue": false,
                "colors": [
                  "rgba(245, 54, 54, 0.9)",
                  "rgba(237, 129, 40, 0.89)",
                  "rgba(50, 172, 45, 0.97)"
                ],
                "datasource": "${DS_PROMETHEUS}",
                "format": "none",
                "gauge": {
                  "maxValue": 100,
                  "minValue": 0,
                  "show": false,
                  "thresholdLabels": false,
                  "thresholdMarkers": true
                },
                "id": 3,
                "interval": null,
                "links": [],
                "mappingType": 1,
                "mappingTypes": [
                  {
                    "name": "value to text",
                    "value": 1
                  },
                  {
                    "name": "range to text",
                    "value": 2
                  }
                ],
                "maxDataPoints": 100,
                "nullPointMode": "connected",
                "nullText": null,
                "postfix": "",
                "postfixFontSize": "50%",
                "prefix": "",
                "prefixFontSize": "50%",
                "rangeMaps": [
                  {
                    "from": "null",
                    "text": "N/A",
                    "to": "null"
                  }
                ],
                "span": 5,
                "sparkline": {
                  "fillColor": "rgba(31, 118, 189, 0.18)",
                  "full": false,
                  "lineColor": "rgb(31, 120, 193)",
                  "show": false
                },
                "targets": [
                  {
                    "expr": "request_duration_seconds_count{name=\"user\", route=\"login\",status_code=\"200\"}",
                    "intervalFactor": 1,
                    "refId": "A",
                    "step": 30
                  }
                ],
                "thresholds": "",
                "title": "# Logins",
                "type": "singlestat",
                "valueFontSize": "80%",
                "valueMaps": [
                  {
                    "op": "=",
                    "text": "N/A",
                    "value": "null"
                  }
                ],
                "valueName": "current"
              }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": false,
            "title": "Dashboard Row",
            "titleSize": "h6"
          }
        ],
        "schemaVersion": 14,
        "style": "dark",
        "tags": [],
        "templating": {
          "list": []
        },
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
          ],
          "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
          ]
        },
        "timezone": "browser",
        "title": "Sock-Shop Analytics",
        "version": 2
      }
    }
  prometheus-datasource.json: |
    {
      "name": "prometheus",
      "type": "prometheus",
      "url": "http://prometheus:9090",
      "access": "proxy",
      "basicAuth": false
    }
  prometheus-node-exporter-dashboard.json: |
    {
      "overwrite": true,
      "inputs": [{
    	"name": "DS_PROMETHEUS",
    	"pluginId": "prometheus",
    	"type": "datasource",
    	"value": "prometheus"
      }],
      "dashboard":{
        "__inputs": [
          {
            "name": "DS_PROMETHEUS",
            "label": "Prometheus",
            "description": "",
            "type": "datasource",
            "pluginId": "prometheus",
            "pluginName": "Prometheus"
          }
        ],
        "__requires": [
          {
            "type": "panel",
            "id": "gauge",
            "name": "Gauge",
            "version": ""
          },
          {
            "type": "grafana",
            "id": "grafana",
            "name": "Grafana",
            "version": "7.3.7"
          },
          {
            "type": "panel",
            "id": "graph",
            "name": "Graph",
            "version": ""
          },
          {
            "type": "datasource",
            "id": "prometheus",
            "name": "Prometheus",
            "version": "1.0.0"
          },
          {
            "type": "panel",
            "id": "singlestat",
            "name": "Singlestat",
            "version": ""
          }
        ],
        "annotations": {
          "list": [
            {
              "$$hashKey": "object:1058",
              "builtIn": 1,
              "datasource": "-- Grafana --",
              "enable": true,
              "hide": true,
              "iconColor": "rgba(0, 211, 255, 1)",
              "name": "Annotations & Alerts",
              "type": "dashboard"
            }
          ]
        },
        "editable": true,
        "gnetId": 1860,
        "graphTooltip": 0,
        "id": null,
        "iteration": 1614605016686,
        "links": [
          {
            "icon": "external link",
            "tags": [],
            "title": "Github",
            "type": "link",
            "url": "https://github.com/rfrail3/grafana-dashboards"
          },
          {
            "icon": "external link",
            "tags": [],
            "title": "Grafana",
            "type": "link",
            "url": "https://grafana.com/grafana/dashboards/1860"
          }
        ],
        "panels": [
          {
            "collapsed": false,
            "datasource": "${DS_PROMETHEUS}",
            "gridPos": {
              "h": 1,
              "w": 24,
              "x": 0,
              "y": 0
            },
            "id": 261,
            "panels": [],
            "repeat": null,
            "title": "Quick CPU / Mem / Disk",
            "type": "row"
          },
          {
            "cacheTimeout": null,
            "datasource": "${DS_PROMETHEUS}",
            "description": "Busy state of all CPU cores together",
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "custom": {},
                "mappings": [
                  {
                    "id": 0,
                    "op": "=",
                    "text": "N/A",
                    "type": 1,
                    "value": "null"
                  }
                ],
                "max": 100,
                "min": 0,
                "nullValueMode": "null",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "rgba(50, 172, 45, 0.97)",
                      "value": null
                    },
                    {
                      "color": "rgba(237, 129, 40, 0.89)",
                      "value": 85
                    },
                    {
                      "color": "rgba(245, 54, 54, 0.9)",
                      "value": 95
                    }
                  ]
                },
                "unit": "percent"
              },
              "overrides": []
            },
            "gridPos": {
              "h": 4,
              "w": 3,
              "x": 0,
              "y": 1
            },
            "id": 20,
            "links": [],
            "options": {
              "orientation": "horizontal",
              "reduceOptions": {
                "calcs": [
                  "lastNotNull"
                ],
                "fields": "",
                "values": false
              },
              "showThresholdLabels": false,
              "showThresholdMarkers": true
            },
            "pluginVersion": "7.3.7",
            "targets": [
              {
                "expr": "(((count(count(node_cpu_seconds_total{instance=\"$node\",job=\"$job\"}) by (cpu))) - avg(sum by (mode)(rate(node_cpu_seconds_total{mode='idle',instance=\"$node\",job=\"$job\"}[$__rate_interval])))) * 100) / count(count(node_cpu_seconds_total{instance=\"$node\",job=\"$job\"}) by (cpu))",
                "hide": false,
                "intervalFactor": 1,
                "legendFormat": "",
                "refId": "A",
                "step": 240
              }
            ],
            "title": "CPU Busy",
            "type": "gauge"
          },
          {
            "cacheTimeout": null,
            "datasource": "${DS_PROMETHEUS}",
            "description": "Busy state of all CPU cores together (5 min average)",
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "custom": {},
                "mappings": [
                  {
                    "id": 0,
                    "op": "=",
                    "text": "N/A",
                    "type": 1,
                    "value": "null"
                  }
                ],
                "max": 100,
                "min": 0,
                "nullValueMode": "null",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "rgba(50, 172, 45, 0.97)",
                      "value": null
                    },
                    {
                      "color": "rgba(237, 129, 40, 0.89)",
                      "value": 85
                    },
                    {
                      "color": "rgba(245, 54, 54, 0.9)",
                      "value": 95
                    }
                  ]
                },
                "unit": "percent"
              },
              "overrides": []
            },
            "gridPos": {
              "h": 4,
              "w": 3,
              "x": 3,
              "y": 1
            },
            "id": 155,
            "links": [],
            "options": {
              "orientation": "horizontal",
              "reduceOptions": {
                "calcs": [
                  "lastNotNull"
                ],
                "fields": "",
                "values": false
              },
              "showThresholdLabels": false,
              "showThresholdMarkers": true
            },
            "pluginVersion": "7.3.7",
            "targets": [
              {
                "expr": "avg(node_load5{instance=\"$node\",job=\"$job\"}) /  count(count(node_cpu_seconds_total{instance=\"$node\",job=\"$job\"}) by (cpu)) * 100",
                "format": "time_series",
                "hide": false,
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              }
            ],
            "title": "Sys Load (5m avg)",
            "type": "gauge"
          },
          {
            "cacheTimeout": null,
            "datasource": "${DS_PROMETHEUS}",
            "description": "Busy state of all CPU cores together (15 min average)",
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "custom": {},
                "mappings": [
                  {
                    "id": 0,
                    "op": "=",
                    "text": "N/A",
                    "type": 1,
                    "value": "null"
                  }
                ],
                "max": 100,
                "min": 0,
                "nullValueMode": "null",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "rgba(50, 172, 45, 0.97)",
                      "value": null
                    },
                    {
                      "color": "rgba(237, 129, 40, 0.89)",
                      "value": 85
                    },
                    {
                      "color": "rgba(245, 54, 54, 0.9)",
                      "value": 95
                    }
                  ]
                },
                "unit": "percent"
              },
              "overrides": []
            },
            "gridPos": {
              "h": 4,
              "w": 3,
              "x": 6,
              "y": 1
            },
            "id": 19,
            "links": [],
            "options": {
              "orientation": "horizontal",
              "reduceOptions": {
                "calcs": [
                  "lastNotNull"
                ],
                "fields": "",
                "values": false
              },
              "showThresholdLabels": false,
              "showThresholdMarkers": true
            },
            "pluginVersion": "7.3.7",
            "targets": [
              {
                "expr": "avg(node_load15{instance=\"$node\",job=\"$job\"}) /  count(count(node_cpu_seconds_total{instance=\"$node\",job=\"$job\"}) by (cpu)) * 100",
                "hide": false,
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              }
            ],
            "title": "Sys Load (15m avg)",
            "type": "gauge"
          },
          {
            "cacheTimeout": null,
            "datasource": "${DS_PROMETHEUS}",
            "description": "Non available RAM memory",
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "custom": {},
                "decimals": 0,
                "mappings": [],
                "max": 100,
                "min": 0,
                "nullValueMode": "null",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "rgba(50, 172, 45, 0.97)",
                      "value": null
                    },
                    {
                      "color": "rgba(237, 129, 40, 0.89)",
                      "value": 80
                    },
                    {
                      "color": "rgba(245, 54, 54, 0.9)",
                      "value": 90
                    }
                  ]
                },
                "unit": "percent"
              },
              "overrides": []
            },
            "gridPos": {
              "h": 4,
              "w": 3,
              "x": 9,
              "y": 1
            },
            "hideTimeOverride": false,
            "id": 16,
            "links": [],
            "options": {
              "orientation": "horizontal",
              "reduceOptions": {
                "calcs": [
                  "lastNotNull"
                ],
                "fields": "",
                "values": false
              },
              "showThresholdLabels": false,
              "showThresholdMarkers": true
            },
            "pluginVersion": "7.3.7",
            "targets": [
              {
                "expr": "((node_memory_MemTotal_bytes{instance=\"$node\",job=\"$job\"} - node_memory_MemFree_bytes{instance=\"$node\",job=\"$job\"}) / (node_memory_MemTotal_bytes{instance=\"$node\",job=\"$job\"} )) * 100",
                "format": "time_series",
                "hide": true,
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              },
              {
                "expr": "100 - ((node_memory_MemAvailable_bytes{instance=\"$node\",job=\"$job\"} * 100) / node_memory_MemTotal_bytes{instance=\"$node\",job=\"$job\"})",
                "format": "time_series",
                "hide": false,
                "intervalFactor": 1,
                "refId": "B",
                "step": 240
              }
            ],
            "title": "RAM Used",
            "type": "gauge"
          },
          {
            "cacheTimeout": null,
            "datasource": "${DS_PROMETHEUS}",
            "description": "Used Swap",
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "custom": {},
                "mappings": [
                  {
                    "id": 0,
                    "op": "=",
                    "text": "N/A",
                    "type": 1,
                    "value": "null"
                  }
                ],
                "max": 100,
                "min": 0,
                "nullValueMode": "null",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "rgba(50, 172, 45, 0.97)",
                      "value": null
                    },
                    {
                      "color": "rgba(237, 129, 40, 0.89)",
                      "value": 10
                    },
                    {
                      "color": "rgba(245, 54, 54, 0.9)",
                      "value": 25
                    }
                  ]
                },
                "unit": "percent"
              },
              "overrides": []
            },
            "gridPos": {
              "h": 4,
              "w": 3,
              "x": 12,
              "y": 1
            },
            "id": 21,
            "links": [],
            "options": {
              "orientation": "horizontal",
              "reduceOptions": {
                "calcs": [
                  "lastNotNull"
                ],
                "fields": "",
                "values": false
              },
              "showThresholdLabels": false,
              "showThresholdMarkers": true
            },
            "pluginVersion": "7.3.7",
            "targets": [
              {
                "expr": "((node_memory_SwapTotal_bytes{instance=\"$node\",job=\"$job\"} - node_memory_SwapFree_bytes{instance=\"$node\",job=\"$job\"}) / (node_memory_SwapTotal_bytes{instance=\"$node\",job=\"$job\"} )) * 100",
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              }
            ],
            "title": "SWAP Used",
            "type": "gauge"
          },
          {
            "cacheTimeout": null,
            "datasource": "${DS_PROMETHEUS}",
            "description": "Used Root FS",
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "custom": {},
                "mappings": [
                  {
                    "id": 0,
                    "op": "=",
                    "text": "N/A",
                    "type": 1,
                    "value": "null"
                  }
                ],
                "max": 100,
                "min": 0,
                "nullValueMode": "null",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "rgba(50, 172, 45, 0.97)",
                      "value": null
                    },
                    {
                      "color": "rgba(237, 129, 40, 0.89)",
                      "value": 80
                    },
                    {
                      "color": "rgba(245, 54, 54, 0.9)",
                      "value": 90
                    }
                  ]
                },
                "unit": "percent"
              },
              "overrides": []
            },
            "gridPos": {
              "h": 4,
              "w": 3,
              "x": 15,
              "y": 1
            },
            "id": 154,
            "links": [],
            "options": {
              "orientation": "horizontal",
              "reduceOptions": {
                "calcs": [
                  "lastNotNull"
                ],
                "fields": "",
                "values": false
              },
              "showThresholdLabels": false,
              "showThresholdMarkers": true
            },
            "pluginVersion": "7.3.7",
            "targets": [
              {
                "expr": "100 - ((node_filesystem_avail_bytes{instance=\"$node\",job=\"$job\",mountpoint=\"/\",fstype!=\"rootfs\"} * 100) / node_filesystem_size_bytes{instance=\"$node\",job=\"$job\",mountpoint=\"/\",fstype!=\"rootfs\"})",
                "format": "time_series",
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              }
            ],
            "title": "Root FS Used",
            "type": "gauge"
          },
          {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(245, 54, 54, 0.9)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(50, 172, 45, 0.97)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "description": "Total number of CPU cores",
            "fieldConfig": {
              "defaults": {
                "custom": {}
              },
              "overrides": []
            },
            "format": "short",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "gridPos": {
              "h": 2,
              "w": 2,
              "x": 18,
              "y": 1
            },
            "id": 14,
            "interval": null,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [
              {
                "name": "value to text",
                "value": 1
              },
              {
                "name": "range to text",
                "value": 2
              }
            ],
            "maxDataPoints": 100,
            "maxPerRow": 6,
            "nullPointMode": "null",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [
              {
                "from": "null",
                "text": "N/A",
                "to": "null"
              }
            ],
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "tableColumn": "",
            "targets": [
              {
                "expr": "count(count(node_cpu_seconds_total{instance=\"$node\",job=\"$job\"}) by (cpu))",
                "interval": "",
                "intervalFactor": 1,
                "legendFormat": "",
                "refId": "A",
                "step": 240
              }
            ],
            "thresholds": "",
            "title": "CPU Cores",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [
              {
                "op": "=",
                "text": "N/A",
                "value": "null"
              }
            ],
            "valueName": "current"
          },
          {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(245, 54, 54, 0.9)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(50, 172, 45, 0.97)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 1,
            "description": "System uptime",
            "fieldConfig": {
              "defaults": {
                "custom": {}
              },
              "overrides": []
            },
            "format": "s",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "gridPos": {
              "h": 2,
              "w": 4,
              "x": 20,
              "y": 1
            },
            "hideTimeOverride": true,
            "id": 15,
            "interval": null,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [
              {
                "$$hashKey": "object:1094",
                "name": "value to text",
                "value": 1
              },
              {
                "$$hashKey": "object:1095",
                "name": "range to text",
                "value": 2
              }
            ],
            "maxDataPoints": 100,
            "nullPointMode": "null",
            "nullText": null,
            "postfix": "s",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [
              {
                "from": "null",
                "text": "N/A",
                "to": "null"
              }
            ],
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "tableColumn": "",
            "targets": [
              {
                "expr": "node_time_seconds{instance=\"$node\",job=\"$job\"} - node_boot_time_seconds{instance=\"$node\",job=\"$job\"}",
                "intervalFactor": 2,
                "refId": "A",
                "step": 240
              }
            ],
            "thresholds": "",
            "title": "Uptime",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [
              {
                "$$hashKey": "object:1097",
                "op": "=",
                "text": "N/A",
                "value": "null"
              }
            ],
            "valueName": "current"
          },
          {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(50, 172, 45, 0.97)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(245, 54, 54, 0.9)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 0,
            "description": "Total RootFS",
            "fieldConfig": {
              "defaults": {
                "custom": {}
              },
              "overrides": []
            },
            "format": "bytes",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "gridPos": {
              "h": 2,
              "w": 2,
              "x": 18,
              "y": 3
            },
            "id": 23,
            "interval": null,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [
              {
                "name": "value to text",
                "value": 1
              },
              {
                "name": "range to text",
                "value": 2
              }
            ],
            "maxDataPoints": 100,
            "maxPerRow": 6,
            "nullPointMode": "null",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "50%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [
              {
                "from": "null",
                "text": "N/A",
                "to": "null"
              }
            ],
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "tableColumn": "",
            "targets": [
              {
                "expr": "node_filesystem_size_bytes{instance=\"$node\",job=\"$job\",mountpoint=\"/\",fstype!=\"rootfs\"}",
                "format": "time_series",
                "hide": false,
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              }
            ],
            "thresholds": "70,90",
            "title": "RootFS Total",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [
              {
                "op": "=",
                "text": "N/A",
                "value": "null"
              }
            ],
            "valueName": "current"
          },
          {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(245, 54, 54, 0.9)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(50, 172, 45, 0.97)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 0,
            "description": "Total RAM",
            "fieldConfig": {
              "defaults": {
                "custom": {}
              },
              "overrides": []
            },
            "format": "bytes",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "gridPos": {
              "h": 2,
              "w": 2,
              "x": 20,
              "y": 3
            },
            "id": 75,
            "interval": null,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [
              {
                "name": "value to text",
                "value": 1
              },
              {
                "name": "range to text",
                "value": 2
              }
            ],
            "maxDataPoints": 100,
            "maxPerRow": 6,
            "nullPointMode": "null",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "70%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [
              {
                "from": "null",
                "text": "N/A",
                "to": "null"
              }
            ],
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "tableColumn": "",
            "targets": [
              {
                "expr": "node_memory_MemTotal_bytes{instance=\"$node\",job=\"$job\"}",
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              }
            ],
            "thresholds": "",
            "title": "RAM Total",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [
              {
                "op": "=",
                "text": "N/A",
                "value": "null"
              }
            ],
            "valueName": "current"
          },
          {
            "cacheTimeout": null,
            "colorBackground": false,
            "colorValue": false,
            "colors": [
              "rgba(245, 54, 54, 0.9)",
              "rgba(237, 129, 40, 0.89)",
              "rgba(50, 172, 45, 0.97)"
            ],
            "datasource": "${DS_PROMETHEUS}",
            "decimals": 0,
            "description": "Total SWAP",
            "fieldConfig": {
              "defaults": {
                "custom": {}
              },
              "overrides": []
            },
            "format": "bytes",
            "gauge": {
              "maxValue": 100,
              "minValue": 0,
              "show": false,
              "thresholdLabels": false,
              "thresholdMarkers": true
            },
            "gridPos": {
              "h": 2,
              "w": 2,
              "x": 22,
              "y": 3
            },
            "id": 18,
            "interval": null,
            "links": [],
            "mappingType": 1,
            "mappingTypes": [
              {
                "name": "value to text",
                "value": 1
              },
              {
                "name": "range to text",
                "value": 2
              }
            ],
            "maxDataPoints": 100,
            "maxPerRow": 6,
            "nullPointMode": "null",
            "nullText": null,
            "postfix": "",
            "postfixFontSize": "70%",
            "prefix": "",
            "prefixFontSize": "50%",
            "rangeMaps": [
              {
                "from": "null",
                "text": "N/A",
                "to": "null"
              }
            ],
            "sparkline": {
              "fillColor": "rgba(31, 118, 189, 0.18)",
              "full": false,
              "lineColor": "rgb(31, 120, 193)",
              "show": false
            },
            "tableColumn": "",
            "targets": [
              {
                "expr": "node_memory_SwapTotal_bytes{instance=\"$node\",job=\"$job\"}",
                "intervalFactor": 1,
                "refId": "A",
                "step": 240
              }
            ],
            "thresholds": "",
            "title": "SWAP Total",
            "type": "singlestat",
            "valueFontSize": "50%",
            "valueMaps": [
              {
                "op": "=",
                "text": "N/A",
                "value": "null"
              }
            ],
            "valueName": "current"
          }
        ],
        "refresh": "1m",
        "schemaVersion": 26,
        "style": "dark",
        "tags": [
          "linux"
        ],
        "templating": {
          "list": [
            {
              "current": {
                "selected": false,
                "text": "default",
                "value": "default"
              },
              "error": null,
              "hide": 0,
              "includeAll": false,
              "label": "datasource",
              "multi": false,
              "name": "DS_PROMETHEUS",
              "options": [],
              "query": "prometheus",
              "refresh": 1,
              "regex": "",
              "skipUrlSync": false,
              "type": "datasource"
            },
            {
              "allValue": null,
              "current": {},
              "datasource": "${DS_PROMETHEUS}",
              "definition": "",
              "error": null,
              "hide": 0,
              "includeAll": false,
              "label": "Job",
              "multi": false,
              "name": "job",
              "options": [],
              "query": "label_values(node_uname_info, job)",
              "refresh": 1,
              "regex": "",
              "skipUrlSync": false,
              "sort": 1,
              "tagValuesQuery": "",
              "tags": [],
              "tagsQuery": "",
              "type": "query",
              "useTags": false
            },
            {
              "allValue": null,
              "current": {},
              "datasource": "${DS_PROMETHEUS}",
              "definition": "label_values(node_uname_info{job=\"$job\"}, instance)",
              "error": null,
              "hide": 0,
              "includeAll": false,
              "label": "Host:",
              "multi": false,
              "name": "node",
              "options": [],
              "query": "label_values(node_uname_info{job=\"$job\"}, instance)",
              "refresh": 1,
              "regex": "",
              "skipUrlSync": false,
              "sort": 1,
              "tagValuesQuery": "",
              "tags": [],
              "tagsQuery": "",
              "type": "query",
              "useTags": false
            },
            {
              "allValue": null,
              "current": {
                "selected": false,
                "text": "[a-z]+|nvme[0-9]+n[0-9]+",
                "value": "[a-z]+|nvme[0-9]+n[0-9]+"
              },
              "error": null,
              "hide": 2,
              "includeAll": false,
              "label": null,
              "multi": false,
              "name": "diskdevices",
              "options": [
                {
                  "selected": true,
                  "text": "[a-z]+|nvme[0-9]+n[0-9]+",
                  "value": "[a-z]+|nvme[0-9]+n[0-9]+"
                }
              ],
              "query": "[a-z]+|nvme[0-9]+n[0-9]+",
              "skipUrlSync": false,
              "type": "custom"
            }
          ]
        },
        "time": {
          "from": "now-24h",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
          ],
          "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
          ]
        },
        "timezone": "browser",
        "title": "Kubernetes Node Resources",
        "uid": "rYdddlPWk",
        "version": 56
      }
    }
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: grafana-import-dashboards
  namespace: monitoring
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana-core
  namespace: monitoring
  labels:
    app: grafana
    component: core
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
      component: core
  template:
    metadata:
      labels:
        app: grafana
        component: core
    spec:
      containers:
      - image: grafana/grafana:7.5.5
        name: grafana-core
        imagePullPolicy: IfNotPresent
        # env:
        resources:
          # keep request = limit to keep this container in guaranteed class
          limits:
            cpu: 100m
            memory: 100Mi
          requests:
            cpu: 100m
            memory: 100Mi
        env:
          # The following env variables set up basic auth twith the default admin user and admin password.
          - name: GF_SECURITY_ADMIN_USER
            value: admin
          - name: GF_SECURITY_ADMIN_PASSWORD
            value: admin
        readinessProbe:
          httpGet:
            path: /login
            port: 3000
          initialDelaySeconds: 30
          timeoutSeconds: 5
        volumeMounts:
        - name: grafana-persistent-storage
          mountPath: /var/lib/grafana
      volumes:
      - name: grafana-persistent-storage
        emptyDir: {}
      nodeSelector:
        beta.kubernetes.io/os: linux
apiVersion: v1
kind: Service
metadata:
  name: grafana
  namespace: monitoring
  labels:
    app: grafana
    component: core
spec:
  type: LoadBalancer
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
    nodePort: 31300
  selector:
    app: grafana
    component: core
apiVersion: batch/v1
kind: Job
metadata:
  name: grafana-import-dashboards
  namespace: monitoring
  labels:
    app: grafana
    component: import-dashboards
spec:
  template:
    metadata:
      name: grafana-import-dashboards
      labels:
        app: grafana
        component: import-dashboards
      annotations:
        pod.beta.kubernetes.io/init-containers: '[
          {
            "name": "wait-for-endpoints",
            "image": "giantswarm/tiny-tools",
            "imagePullPolicy": "IfNotPresent",
            "command": ["fish", "-c", "echo \"waiting for endpoints...\"; while true; set endpoints (curl -s --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt --header \"Authorization: Bearer \"(cat /var/run/secrets/kubernetes.io/serviceaccount/token) https://kubernetes.default.svc/api/v1/namespaces/monitoring/endpoints/grafana); echo $endpoints | jq \".\"; if test (echo $endpoints | jq -r \".subsets[].addresses | length\") -gt 0; exit 0; end; echo \"waiting...\";sleep 1; end"],
            "args": ["monitoring", "grafana"]
          }
        ]'
    spec:
      containers:
      - name: grafana-import-dashboards
        image: giantswarm/tiny-tools
        command: ["/bin/sh", "-c"]
        workingDir: /opt/grafana-import-dashboards
        args:
          - >
            for file in *-datasource.json ; do
              if [ -e "$file" ] ; then
                echo "importing $file" &&
                curl --silent --fail --show-error \
                  --request POST http://admin:admin@grafana/api/datasources \
                  --header "Content-Type: application/json" \
                  --header "Accept: application/json" \
                  --data-binary "@$file" ;
                echo "" ;
              fi
            done ;
            for file in *-dashboard.json ; do
              if [ -e "$file" ] ; then
                echo "importing $file" &&
                curl --silent --fail --show-error \
                  --request POST http://admin:admin@grafana/api/dashboards/import \
                  --header "Content-Type: application/json" \
                  --header "Accept: application/json" \
                  --data-binary "@$file" ;
                echo "" ;
              fi
            done ;
        volumeMounts:
        - name: config-volume
          mountPath: /opt/grafana-import-dashboards
      restartPolicy: Never
      volumes:
      - name: config-volume
        configMap:
          name: grafana-import-dashboards
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: exporter
    app.kubernetes.io/name: node-exporter
  name: node-exporter
  namespace: monitoring
apiVersion: apps/v1
kind: DaemonSet
metadata:
  labels:
    app.kubernetes.io/component: exporter
    app.kubernetes.io/name: node-exporter
  name: node-exporter
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app.kubernetes.io/component: exporter
      app.kubernetes.io/name: node-exporter
  template:
    metadata:
      labels:
        app.kubernetes.io/component: exporter
        app.kubernetes.io/name: node-exporter
    spec:
      containers:
      - args:
        - --web.listen-address=0.0.0.0:9100
        - --path.sysfs=/host/sys
        - --path.rootfs=/host/root
        - --no-collector.wifi
        - --no-collector.hwmon
        - --collector.filesystem.ignored-mount-points=^/(dev|proc|sys|var/lib/docker/.+|var/lib/kubelet/pods/.+)($|/)
        - --collector.netclass.ignored-devices=^(veth.*)$
        - --collector.netdev.device-exclude=^(veth.*)$
        image: quay.io/prometheus/node-exporter:v1.1.2
        name: node-exporter
        resources:
          limits:
            cpu: 250m
            memory: 180Mi
          requests:
            cpu: 102m
            memory: 180Mi
        volumeMounts:
        - mountPath: /host/sys
          mountPropagation: HostToContainer
          name: sys
          readOnly: true
        - mountPath: /host/root
          mountPropagation: HostToContainer
          name: root
          readOnly: true
        ports:
        - containerPort: 9100
          hostPort: 9100
          name: http
      hostNetwork: true
      hostPID: true
      nodeSelector:
        kubernetes.io/os: linux
      securityContext:
        runAsNonRoot: true
        runAsUser: 65534
      serviceAccountName: node-exporter
      tolerations:
      - operator: Exists
      volumes:
      - hostPath:
          path: /sys
        name: sys
      - hostPath:
          path: /
        name: root
  updateStrategy:
    rollingUpdate:
      maxUnavailable: 10%
    type: RollingUpdate
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: exporter
    app.kubernetes.io/name: node-exporter
  name: node-exporter
  namespace: monitoring
spec:
  clusterIP: None
  ports:
  - name: http
    port: 9100
    targetPort: 9100
  selector:
    app.kubernetes.io/component: exporter
    app.kubernetes.io/name: node-exporter
